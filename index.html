<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR –ö–æ—Ñ–µ</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        /* –°–ë–†–û–° –í–°–ï–• –°–¢–ò–õ–ï–ô - —ç—Ç–æ –≤–∞–∂–Ω–æ! */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
            background: black;
        }
        
        /* –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ */
        #startButton {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #8B4513;
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 20px;
            border-radius: 30px;
            cursor: pointer;
            z-index: 1000;
        }
        
        /* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è */
        #instruction {
            position: absolute;
            top: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            color: white;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            z-index: 1000;
            font-family: Arial;
        }
        
        /* AR —Å—Ü–µ–Ω–∞ - –§–ò–ö–°–ò–†–û–í–ê–ù–ù–´–ï –†–ê–ó–ú–ï–†–´ */
        #arScene {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            display: none;
        }
    </style>
</head>
<body>
    <div id="instruction">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ AR</div>
    <button id="startButton">üé• –ó–∞–ø—É—Å—Ç–∏—Ç—å AR</button>

    <!-- –£–ü–†–û–©–ï–ù–ù–ê–Ø AR –°–¶–ï–ù–ê -->
    <a-scene 
        vr-mode-ui="enabled: false"
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono; matrixCodeType: 3x3;"
        embedded
        renderer="logarithmicDepthBuffer: true;"
        id="arScene"
    >
        <!-- –ö–∞–º–µ—Ä–∞ -->
        <a-camera></a-camera>

        <!-- –ú–∞—Ä–∫–µ—Ä —Å –°–ò–õ–¨–ù–´–ú —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ–º -->
        <a-marker 
            type="pattern" 
            url="assets/pattern-marker.patt"
            smooth="true"
            smoothCount="10"
            smoothTolerance="0.005"
            smoothThreshold="1"
            emitevents="true"
        >
            <!-- –í–∏–¥–µ–æ —Å –ü–†–ê–í–ò–õ–¨–ù–´–ú–ò —Ä–∞–∑–º–µ—Ä–∞–º–∏ -->
            <a-video 
                src="assets/video.mp4"
                width="1.6"     <!-- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ 16:9 -->
                height="0.9"    <!-- 1.6 / 0.9 = 16:9 -->
                position="0 1.0 0"
                rotation="-90 0 0"
                muted="true"
                loop="true"
                autoplay="true"
                visible="false"
                id="arVideo"
            ></a-video>
        </a-marker>
    </a-scene>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const startButton = document.getElementById('startButton');
            const scene = document.getElementById('arScene');
            const instruction = document.getElementById('instruction');
            
            startButton.addEventListener('click', function() {
                console.log('–ó–∞–ø—É—Å–∫–∞–µ–º AR...');
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                startButton.style.display = 'none';
                instruction.textContent = '–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ...';
                
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ
                if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                    navigator.mediaDevices.getUserMedia({ 
                        video: { 
                            facingMode: 'environment' // –ó–∞–¥–Ω—è—è –∫–∞–º–µ—Ä–∞
                        } 
                    })
                    .then(function(stream) {
                        console.log('–ö–∞–º–µ—Ä–∞ –¥–æ—Å—Ç—É–ø–Ω–∞!');
                        
                        // –ü–û–ö–ê–ó–´–í–ê–ï–ú —Å—Ü–µ–Ω—É
                        scene.style.display = 'block';
                        instruction.textContent = '–ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ —É–ø–∞–∫–æ–≤–∫—É –∫–æ—Ñ–µ';
                        
                        // –ù–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ—Å–ª–µ –ø–æ–∫–∞–∑–∞ —Å—Ü–µ–Ω—ã
                        const marker = document.querySelector('a-marker');
                        const video = document.getElementById('arVideo');
                        
                        // –ö–æ–≥–¥–∞ –º–∞—Ä–∫–µ—Ä –Ω–∞–π–¥–µ–Ω
                        marker.addEventListener('markerFound', function() {
                            console.log('‚úÖ –£–ø–∞–∫–æ–≤–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞!');
                            instruction.textContent = '–£–ø–∞–∫–æ–≤–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞!';
                            video.setAttribute('visible', 'true');
                            
                            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ–º –≤–∏–¥–µ–æ
                            try {
                                const videoElement = video.components.material.material.map.image;
                                videoElement.play().catch(e => {
                                    console.log('–í–∏–¥–µ–æ –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:', e);
                                });
                            } catch (e) {
                                console.log('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–∏–¥–µ–æ:', e);
                            }
                        });
                        
                        // –ö–æ–≥–¥–∞ –º–∞—Ä–∫–µ—Ä –ø–æ—Ç–µ—Ä—è–Ω
                        marker.addEventListener('markerLost', function() {
                            console.log('–ú–∞—Ä–∫–µ—Ä –ø–æ—Ç–µ—Ä—è–Ω');
                            instruction.textContent = '–ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ —É–ø–∞–∫–æ–≤–∫—É –∫–æ—Ñ–µ';
                            video.setAttribute('visible', 'false');
                        });
                    })
                    .catch(function(error) {
                        console.error('‚ùå –û—à–∏–±–∫–∞ –∫–∞–º–µ—Ä—ã:', error);
                        instruction.textContent = '–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è.';
                        startButton.style.display = 'block';
                        startButton.textContent = 'üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞';
                    });
                } else {
                    instruction.textContent = '–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç AR';
                }
            });
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤ –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
            setTimeout(() => {
                const canvas = document.querySelector('canvas');
                if (canvas) {
                    canvas.style.width = '100%';
                    canvas.style.height = '100%';
                    canvas.style.position = 'fixed';
                    canvas.style.top = '0';
                    canvas.style.left = '0';
                }
            }, 1000);
        });
    </script>
</body>
</html>
