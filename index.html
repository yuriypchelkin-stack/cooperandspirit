<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR –ö–æ—Ñ–µ</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
        }
        body {
            background: #000;
            font-family: Arial, sans-serif;
        }
        #instruction {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            text-align: center;
            color: white;
            background: rgba(0,0,0,0.7);
            padding: 20px;
            z-index: 1000;
            pointer-events: none;
        }
        #startButton {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            background: #8B4513;
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 20px;
            border-radius: 30px;
            cursor: pointer;
            z-index: 1001;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        #arScene {
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            display: none;
        }
        /* –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ –∫–∞–Ω–≤–∞—Å –∑–∞–Ω–∏–º–∞–µ—Ç –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
        .a-canvas {
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
        }
    </style>
</head>
<body>
    <div id="instruction">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ AR</div>
    <button id="startButton">üé• –ó–∞–ø—É—Å—Ç–∏—Ç—å AR</button>

    <!-- –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è AR —Å—Ü–µ–Ω–∞ -->
    <a-scene 
        vr-mode-ui="enabled: false"
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono;"
        embedded
        renderer="logarithmicDepthBuffer: true;"
        id="arScene"
    >
        <!-- –ö–∞–º–µ—Ä–∞ - –û–ß–ï–ù–¨ –í–ê–ñ–ù–û –¥–ª—è AR.js -->
        <a-camera 
            id="camera"
            position="0 0 0"
        ></a-camera>

        <!-- –ú–∞—Ä–∫–µ—Ä -->
        <a-marker 
            type="pattern" 
            url="assets/pattern-marker.patt"
            id="marker"
            smooth="true"
            smoothCount="10"
            smoothTolerance="0.01"
        >
            <!-- –í–∏–¥–µ–æ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏ -->
            <a-video 
                src="assets/video.mp4"
                width="1.6"
                height="0.9"
                position="0 0.8 0"
                rotation="-90 0 0"
                muted="true"
                loop="true"
                autoplay="true"
                id="arVideo"
                visible="false"
            ></a-video>
        </a-marker>
    </a-scene>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const startButton = document.getElementById('startButton');
            const scene = document.getElementById('arScene');
            const instruction = document.getElementById('instruction');
            const camera = document.getElementById('camera');
            
            startButton.addEventListener('click', function() {
                console.log('–ó–∞–ø—É—Å–∫ AR...');
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                startButton.style.display = 'none';
                instruction.textContent = '–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ...';
                
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ
                if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                    navigator.mediaDevices.getUserMedia({ 
                        video: { 
                            facingMode: 'environment' // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–¥–Ω—é—é –∫–∞–º–µ—Ä—É
                        } 
                    })
                    .then(function(stream) {
                        console.log('–î–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –ø–æ–ª—É—á–µ–Ω');
                        
                        // –ü–û–ö–ê–ó–´–í–ê–ï–ú —Å—Ü–µ–Ω—É
                        scene.style.display = 'block';
                        instruction.textContent = '–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ —É–ø–∞–∫–æ–≤–∫—É –∫–æ—Ñ–µ';
                        
                        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–∞—Ä–∫–µ—Ä–∞
                        const marker = document.getElementById('marker');
                        const video = document.getElementById('arVideo');
                        
                        marker.addEventListener('markerFound', function() {
                            console.log('–ú–∞—Ä–∫–µ—Ä –Ω–∞–π–¥–µ–Ω!');
                            instruction.textContent = '–£–ø–∞–∫–æ–≤–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞!';
                            video.setAttribute('visible', 'true');
                            
                            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ–º –≤–∏–¥–µ–æ
                            try {
                                const videoElement = video.components.material.material.map.image;
                                videoElement.play();
                            } catch (e) {
                                console.log('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', e);
                            }
                        });
                        
                        marker.addEventListener('markerLost', function() {
                            console.log('–ú–∞—Ä–∫–µ—Ä –ø–æ—Ç–µ—Ä—è–Ω');
                            instruction.textContent = '–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ —É–ø–∞–∫–æ–≤–∫—É –∫–æ—Ñ–µ';
                            video.setAttribute('visible', 'false');
                        });
                    })
                    .catch(function(error) {
                        console.error('–û—à–∏–±–∫–∞ –∫–∞–º–µ—Ä—ã:', error);
                        instruction.textContent = '–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞.';
                        startButton.style.display = 'block';
                        startButton.textContent = 'üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞';
                    });
                } else {
                    instruction.textContent = '–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç AR';
                    startButton.style.display = 'block';
                }
            });
        });
    </script>
</body>
</html>
