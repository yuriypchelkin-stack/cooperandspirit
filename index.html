<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR –ö–æ—Ñ–µ</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        
        .ar-button {
            background: #8B4513;
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 20px;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }
        
        .ar-button:hover {
            background: #A0522D;
            transform: scale(1.05);
        }
        
        #loading {
            display: none;
            color: #8B4513;
            font-size: 18px;
        }
        
        a-scene {
            display: none;
            width: 100%;
            height: 100vh;
        }
    </style>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>
<body>
    <div id="main-content">
        <button id="ar-button" class="ar-button">
            üï∂Ô∏è –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ AR
        </button>
        <div id="loading">–ó–∞–≥—Ä—É–∑–∫–∞ AR...</div>
    </div>

    <a-scene 
        vr-mode-ui="enabled: false"
        arjs="sourceType: webcam; debugUIEnabled: true;"
        embedded
        renderer="logarithmicDepthBuffer: true;"
    >
        <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç–æ–π –º–∞—Ä–∫–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
        <a-marker 
            preset="hiro"
            raycaster="objects: .clickable"
        >
            <a-video 
                src="./assets/video.mp4"
                position="0 1.5 0"
                width="2"
                height="1"
                rotation="-90 0 0"
                class="clickable"
                autoplay="true"
                loop="true"
                visible="true"
            ></a-video>
        </a-marker>
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const arButton = document.getElementById('ar-button');
            const loading = document.getElementById('loading');
            const mainContent = document.getElementById('main-content');
            const scene = document.querySelector('a-scene');
            
            console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            
            arButton.addEventListener('click', function() {
                console.log('–ö–Ω–æ–ø–∫–∞ –Ω–∞–∂–∞—Ç–∞');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                arButton.style.display = 'none';
                loading.style.display = 'block';
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    alert('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ');
                    return;
                }
                
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(function(stream) {
                        console.log('–î–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –ø–æ–ª—É—á–µ–Ω');
                        
                        // –°–∫—Ä—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º AR
                        mainContent.style.display = 'none';
                        scene.style.display = 'block';
                        loading.style.display = 'none';
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–∞—Ä–∫–µ—Ä–∞
                        const marker = document.querySelector('a-marker');
                        if (marker) {
                            marker.addEventListener('markerFound', function() {
                                console.log('–ú–∞—Ä–∫–µ—Ä –Ω–∞–π–¥–µ–Ω!');
                                const video = document.querySelector('a-video');
                                if (video) {
                                    video.setAttribute('visible', 'true');
                                    // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–∏–¥–µ–æ
                                    const videoEl = video.components.material.material.map.image;
                                    videoEl.play().catch(e => console.log('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', e));
                                }
                            });
                            
                            marker.addEventListener('markerLost', function() {
                                console.log('–ú–∞—Ä–∫–µ—Ä –ø–æ—Ç–µ—Ä—è–Ω');
                                const video = document.querySelector('a-video');
                                if (video) {
                                    video.setAttribute('visible', 'false');
                                }
                            });
                        }
                    })
                    .catch(function(error) {
                        console.error('–û—à–∏–±–∫–∞ –∫–∞–º–µ—Ä—ã:', error);
                        alert('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ: ' + error.message);
                        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É
                        arButton.style.display = 'block';
                        loading.style.display = 'none';
                    });
            });
        });
    </script>
</body>
</html>